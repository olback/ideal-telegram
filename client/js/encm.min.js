class Encm{static addFriend(username,public_key){let a=JSON.parse(window.localStorage.getItem("friends"));for(let f of a)if(f.username===username)return{error:!0,msg:"Friend already added"};return a.push({username:username,public_key:public_key}),window.localStorage.setItem("friends",JSON.stringify(a)),{error:!1,msg:"Friend added"}}static delFriend(username){let a=JSON.parse(window.localStorage.getItem("friends"));for(let i=0;i<a.length;i++)if(a[i].username===username)return a.splice(i,1),window.localStorage.setItem("friends",JSON.stringify(a)),window.sessionStorage.removeItem(username),{error:!1,msg:"Friend deleted"};return{error:!0,msg:"Friend not found"}}static updatePubkey(username,public_key){let a=JSON.parse(window.localStorage.getItem("friends"));for(let i=0;i<a.length;i++)if(a[i].username===username)return a[i].public_key=public_key,window.localStorage.setItem("friends",JSON.stringify(a)),{error:!1,msg:"Friend updated"};return{error:!0,msg:"Friend not found"}}static isFriend(username){let a=JSON.parse(window.localStorage.getItem("friends"));for(let i=0;i<a.length;i++)if(a[i].username===username)return!0}static sessionStoreMessage(store,username,message){null===window.sessionStorage.getItem(store)&&window.sessionStorage.setItem(store,"[]");let a=JSON.parse(window.sessionStorage.getItem(store));a.push({from:username,message:message}),a.length>100&&a.splice(0,1),window.sessionStorage.setItem(store,JSON.stringify(a))}}if(null===window.localStorage.getItem("friends")&&window.localStorage.setItem("friends","[]"),null===window.localStorage.getItem("username")&&window.localStorage.setItem("username",prompt("Enter a username:")),null===window.localStorage.getItem("pgp.passphrase")&&window.localStorage.setItem("pgp.passphrase",window.crypto.getRandomValues(new Uint32Array(32)).join("")),null===window.localStorage.getItem("pgp.public")||null===window.localStorage.getItem("pgp.private")){let options={userIds:[{name:"olback"}],curve:"ed25519",passphrase:window.localStorage.getItem("pgp.passphrase")};openpgp.generateKey(options).then(key=>{window.localStorage.setItem("pgp.private",key.privateKeyArmored),window.localStorage.setItem("pgp.public",key.publicKeyArmored)})}